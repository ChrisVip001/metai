# MetaI (Meta Intelligence)

<div align="center">

**åŸºäº Rust + Burn 0.19.1 çš„å·¥ä¸šçº§é«˜æ€§èƒ½å¤§è¯­è¨€æ¨¡å‹ (LLM) å…¨æ ˆæ¡†æ¶**

[æ ¸å¿ƒç‰¹æ€§](#âœ¨-æ ¸å¿ƒç‰¹æ€§) | [åˆ†å¸ƒå¼æ·±åº¦è§£æ](#ğŸŒ-åˆ†å¸ƒå¼é›†ç¾¤è®­ç»ƒ-deep-dive) | [å¿«é€Ÿå¼€å§‹](#ğŸš€-å¿«é€Ÿå¼€å§‹) | [æ¶æ„è®¾è®¡](#ğŸ—ï¸-é¡¹ç›®æ¶æ„è®¾è®¡)

---

MetaI å¹¶éä¸€ä¸ªç®€å•çš„ LLM æ¼”ç¤ºé¡¹ç›®ï¼Œè€Œæ˜¯ä¸€ä¸ªæ—¨åœ¨æŒ‘æˆ˜ 2026 å¹´å¤§æ¨¡å‹å·¥ä¸šç•Œå·…å³°æ€§èƒ½çš„ **å…¨é“¾è·¯ç ”å‘æ¡†æ¶**ã€‚æˆ‘ä»¬åˆ©ç”¨ Rust çš„æè‡´å®‰å…¨ä¸å¹¶å‘ç‰¹æ€§ï¼Œç»“åˆ [Burn](https://github.com/tracel-ai/burn) æ·±åº¦å­¦ä¹ å¼•æ“ï¼Œå®ç°äº†ä»å•æœº 125M åŸå‹éªŒè¯åˆ°é›†ç¾¤çº§ **685B é¡¶é…æ¶æ„** çš„æ— ç¼åˆ‡æ¢ã€‚

</div>

## âœ¨ æ ¸å¿ƒç‰¹æ€§ï¼šçªç ´æŠ€æœ¯å¤©èŠ±æ¿

### 1. å·…å³°æ€§èƒ½ä¸å·¥ç¨‹åŒ–
*   **Rust åŸç”Ÿæ‰§è¡Œ**ï¼šæ‘’å¼ƒå¤æ‚çš„ C++ ç»‘å®šï¼Œå…¨é“¾è·¯ Rust å®ç°ï¼Œç¡®ä¿æ˜¾å­˜ç®¡ç†çš„ç»å¯¹ç²¾ç¡®ã€‚
*   **åˆ†å¸ƒå¼é›†ç¾¤è®­ç»ƒ**ï¼šå†…ç½®å¤šæœºå¤šå¡ DDP (Distributed Data Parallel) ä¸ä¸“å®¶å¹¶è¡Œ (Expert Parallel) æ¨¡å¼ï¼ŒåŸç”Ÿå¯¹æŠ— NCCL é€šä¿¡ç“¶é¢ˆã€‚
*   **685B çº§æ¶æ„æ”¯æŒ**ï¼šç‡å…ˆæ”¯æŒ **DeepSeek-V3.2** è§„æ ¼ï¼Œé›†æˆ **Multi-Token Prediction (MTP)** å¹¶è¡Œè®­ç»ƒåŠ é€ŸæŠ€æœ¯ã€‚
*   **KV Cache 2.0**: é…åˆ **Multi-head Latent Attention (MLA)**ï¼Œåœ¨ 128K è¶…é•¿ä¸Šä¸‹æ–‡ç”Ÿæˆæ—¶ï¼ŒKV Cache æ˜¾å­˜å ç”¨ä»…ä¸ºä¼ ç»Ÿæ¶æ„çš„ 1/8ã€‚

### 2. ä¸‹ä¸€ä»£å¯¹é½ç®—æ³• (Alignment)
*   **GRPO (Grouped Relative Policy Optimization)**ï¼šåŸç”Ÿå®ç° DeepSeek-R1 åŒæ¬¾ç®—æ³•ã€‚é€šè¿‡ç»„å†…ç›¸å¯¹å¥–åŠ±å½’ä¸€åŒ–ï¼Œæ— éœ€æ˜‚è´µçš„ Critic æ¨¡å‹å³å¯å®ç°å¼ºåŒ–å­¦ä¹ ï¼Œæå¤§åœ°æå‡äº†æ¨¡å‹çš„é€»è¾‘æ¨ç† (System 2) èƒ½åŠ›ã€‚
*   **SFT & DPO**ï¼šæ”¯æŒå¸¦ Loss Masking çš„æŒ‡ä»¤å¾®è°ƒåŠç›´æ¥åå¥½ä¼˜åŒ–ï¼Œå®Œç¾è§£å†³å˜é•¿åºåˆ—ä¸‹çš„ Loss æ±¡æŸ“é—®é¢˜ã€‚

### 3. å…ˆè¿›æ¨ç†æŠ€æœ¯
*   **è§„æ ¼é¢„æµ‹è§£ç  (Speculative Decoding)**ï¼šæ”¯æŒ Draft Model å¼•å¯¼çš„å¿«é€Ÿç”Ÿæˆï¼Œåˆ©ç”¨å°æ¨¡å‹éªŒè¯å¤§æ¨¡å‹ Tokenï¼Œç”Ÿæˆé€Ÿåº¦æå‡ 2x-3xã€‚
*   **INT4 é‡åŒ–éƒ¨ç½²**ï¼šåŸºäº Block-wise çš„ 4-bit æƒé‡é‡åŒ–ï¼Œæ”¯æŒåœ¨æ¶ˆè´¹çº§æ˜¾å¡ä¸Šè¿è¡ŒåŸæœ¬æ— æ³•æ‰¿è½½çš„å·¨å‹å·æ¨¡å‹ã€‚

---

## ğŸŒ åˆ†å¸ƒå¼é›†ç¾¤è®­ç»ƒ Deep Dive

åœ¨ `metai` ä¸­ï¼Œå¤§è§„æ¨¡åˆ†å¸ƒå¼è®­ç»ƒä¸å†æ˜¯é»‘ç®±ã€‚åˆ©ç”¨ `LibTorch` (Burn-tch) åç«¯ï¼Œæ·±åº¦è°ƒç”¨ Tensor Cores ç®—åŠ›ï¼Œé€šè¿‡ `train-cluster` å‘½ä»¤ï¼Œä½ å¯ä»¥ç›´æ¥æ“ä½œ **685B MoE** çº§æ¨¡å‹ï¼š

```bash
# åœ¨ A100/H100 é›†ç¾¤ä¸Šå¯åŠ¨ 685B é¡¶é…è®­ç»ƒ
# éœ€ç¡®ä¿ç³»ç»Ÿå·²å®‰è£… CUDA å’Œ cuDNN
cargo run --release --no-default-features --features cuda -- train-cluster \
    --world-size 128 \
    --chinese-path /mnt/data/huge_zh_corpus.jsonl \
    --english-path /mnt/data/huge_en_corpus.jsonl
```

### æ ¸å¿ƒä¼˜åŒ–é€»è¾‘ï¼š
1.  **ä¸“å®¶å¹¶è¡Œ (Expert Parallelism)**ï¼šé’ˆå¯¹ 256 ä½ä¸“å®¶ï¼Œä»…æ¿€æ´» Top-8ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨å°†ä¸åŒä¸“å®¶åˆ†å‘è‡³ä¸åŒèŠ‚ç‚¹ï¼Œåˆ©ç”¨ All-to-All é€šä¿¡å®ç°è¶…å¤§è§„æ¨¡ MoEã€‚
2.  **ååé‡å±è”½ (Throughput Hiding)**ï¼šé»˜è®¤è®¾ç½® `grads_accumulation = 256`ã€‚é€šè¿‡å¢å¤§ç´¯ç§¯æ­¥æ•°ï¼Œè®© GPU åœ¨è¿›è¡Œæ¢¯åº¦è®¡ç®—æ—¶èƒ½åŒæ—¶å‘èµ·è·¨æœºé€šä¿¡ï¼Œæœ€å¤§åŒ–å¸¦å®½åˆ©ç”¨ç‡ã€‚
3.  **128K åˆ†ç‰‡åŠ è½½**ï¼š`LazyTextDataset` ä¼šæ ¹æ®è®¾å¤‡çš„ `Rank` è‡ªåŠ¨è¿›è¡Œç‰©ç†ç´¢å¼•åˆ‡ç‰‡ï¼Œç¡®ä¿æ²¡æœ‰ä»»ä½•ä¸€å°æœºå™¨éœ€è¦é¢„åŠ è½½å…¨é‡æ•°æ®é›†ã€‚

---

## ï¿½ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡
- **Rust**: Nightly (æ¨è) æˆ– 1.70+
- **ç¡¬ä»¶**: æ¨è Nvidia RTX 30/40 ç³»åˆ— (å•æœºéªŒè¯) æˆ– A100/H100/H200 (åˆ†å¸ƒå¼)
- **é©±åŠ¨**: éœ€æ­£ç¡®é…ç½® CUDA 12.x æˆ– WGPU è¿è¡Œæ—¶

### 2. è®­ç»ƒä½ çš„ç¬¬ä¸€ä¸ª Small æ¨¡å‹ (125M)
é€‚åˆåœ¨æœ¬åœ° 16GB+ æ˜¾å­˜è®¾å¤‡ä¸Šå¿«é€Ÿè¿è¡Œï¼š

```bash
# å…‹éš†å¹¶ç¼–è¯‘
git clone https://github.com/ChrisVip001/metai.git && cd metai
cargo build --release

# å¯åŠ¨è®­ç»ƒ (è‡ªåŠ¨å¼€å¯ TUI ç›‘æ§)
cargo run --release -- train-small \
    --chinese-path 4in1.txt \
    --english-path dataset.txt \
    --output-dir output_small
```

### 3. é«˜çº§è®­ç»ƒé€‰é¡¹

**Micro æ¨¡å¼ (5-30M å‚æ•°)**
æé€ŸéªŒè¯é€»è¾‘ï¼Œé€‚åˆè½»é‡çº§å¼€å‘ï¼š
```bash
cargo run --release -- train-micro \
    --chinese-path 4in1.txt \
    --english-path dataset.txt \
    --output-dir output_micro
```

**Custom è‡ªå®šä¹‰æ¨¡å¼**
é€šè¿‡å‘½ä»¤è¡Œçµæ´»è°ƒæ•´æ¨¡å‹æ¶æ„ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ï¼š
```bash
# è®­ç»ƒä¸€ä¸ª 64ç»´ã€2å±‚çš„ Nano æ¨¡å‹
cargo run --release -- train-custom \
    --chinese-path 4in1.txt \
    --english-path dataset.txt \
    --output-dir output_custom \
    --hidden-dim 64 \ # æ¨¡å‹éšè—å±‚ç»´åº¦
    --num-layers 2 \ # æ¨¡å‹å±‚æ•°
    --num-heads 2 \ # æ¨¡å‹å¤´æ•°
    --num-kv-heads 1 \ # KV Cache å¤´æ•°
    --mlp-dim 128 \ # MLP å±‚ç»´åº¦
    --batch-size 8 \ # æ‰¹å¤„ç†å¤§å°
```

---

## ğŸ§  RLHF å¼ºåŒ–å­¦ä¹ ä¸æ¨ç†å¢å¼º (GRPO)

MetaI æ·±åº¦é›†æˆäº†æ¨ç†å¢å¼ºæŠ€æœ¯ï¼Œæ—¨åœ¨è®©æ¨¡å‹å­¦ä¼šâ€œæ€è€ƒâ€ï¼š

```bash
# é’ˆå¯¹æ•°å­¦ã€ä»£ç æ¨ç†ä»»åŠ¡è¿›è¡Œ GRPO è®­ç»ƒ
cargo run --release -- train-grpo \
    --data data/math_reasoning.jsonl \
    --model-dir checkpoints/sft_warmup \
    --output-dir checkpoints/grpo_reasoning
```

**ç®—æ³•ä¼˜åŠ¿ï¼š**
- **Advantage Normalization**: åœ¨æ¯ç»„ sampleï¼ˆGroup Size å¯é…ç½®ï¼‰å†…éƒ¨è®¡ç®—ç›¸å¯¹å¥–åŠ±ï¼Œå¼ºåˆ¶æ¨¡å‹åœ¨ç»„å†…ç«äº‰ã€‚
- **Kullbackâ€“Leibler (KL) Penalty**: è‡ªåŠ¨æ§åˆ¶ Policy åç¦» Reference æ¨¡å‹çš„ç¨‹åº¦ï¼Œç¡®ä¿è®­ç»ƒç¨³å®šæ€§ã€‚

---

## ğŸ§ª æ¨¡å‹é…ç½®æ·±åº¦å¯¹æ¯”

| é…ç½®æ ‡è¯† | æ€»å‚æ•°é‡ | ç‰¹è‰²æ¶æ„ | ä¸Šä¸‹æ–‡çª—å£ | å…¸å‹ç¡¬ä»¶ |
|:---|:---|:---|:---|:---|
| **Small** | 125M | 8E MoE, Top-2 | 2K | RTX 3060 (12G) |
| **DS-V3.2** | **685B** | **256E MoE, MLA, MTP** | **128K** | **H100 x 8 Cluster** |

---

## ğŸ—ï¸ é¡¹ç›®æ¶æ„è®¾è®¡

```text
src/
â”œâ”€â”€ model/
â”‚   â”œâ”€â”€ attention.rs         # é›†æˆ MLA (Multi-head Latent Attention) ä¸ GQA
â”‚   â”œâ”€â”€ mlp.rs               # ç¨€ç– MoE ä¸“å®¶å±‚ï¼Œæ”¯æŒåŠ¨æ€ä¸“å®¶åŠ¨æ€è´Ÿè½½å‡è¡¡
â”‚   â”œâ”€â”€ config.rs            # ä» Llama åˆ° DeepSeek-V3.2 çš„å…¨é‡é…ç½®å®šä¹‰
â”‚   â””â”€â”€ positional_encoding.rs # RoPE æ—‹è½¬ä½ç½®ç¼–ç  (æ”¯æŒé•¿æ–‡æœ¬å¤–æ¨)
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ distributed.rs       # åˆ†å¸ƒå¼ DDP ä¸è·¨æœºè´Ÿè½½å‡è¡¡é€»è¾‘
â”‚   â”œâ”€â”€ grpo.rs              # å¼ºåŒ–å­¦ä¹ ç®—æ³•å®ç° (ä¸éœ€è¦ Value Model)
â”‚   â”œâ”€â”€ sft.rs               # ç›‘ç£å¾®è°ƒï¼Œå¸¦ Loss Masking æœºåˆ¶
â”‚   â””â”€â”€ mod.rs               # ç»Ÿä¸€è®­ç»ƒå…¥å£ä¸ Learner å°è£…
â”œâ”€â”€ infer/
â”‚   â”œâ”€â”€ cache.rs             # å·¥ä¸šçº§ KV Cache ç®¡ç† (æ”¯æŒ MLA å‹ç¼©)
â”‚   â””â”€â”€ mod.rs               # æ–‡æœ¬ç”Ÿæˆå¼•æ“ä¸æŠ•æœºé‡‡æ ·å™¨
â””â”€â”€ data/
    â””â”€â”€ data.rs              # åŸºäºç£ç›˜ç´¢å¼•çš„ Lazy Loadingï¼Œæ”¯æŒ TB çº§æ•°æ®
```

---

## ğŸ¤ è´¡çŒ®ä¸åŠ å…¥

MetaI è‡´åŠ›äºå»ºç«‹ Rust åœ¨å¤§è¯­è¨€æ¨¡å‹é¢†åŸŸçš„ **é¡¶çº§ç”Ÿæ€**ã€‚å¦‚æœä½ å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ã€GPU ç®—å­ä¼˜åŒ–æˆ–å°–ç«¯å¯¹é½ç­–ç•¥æ„Ÿå…´è¶£ï¼Œæ¬¢è¿éšæ—¶å¼€å¯ Pull Request æˆ– Issueã€‚

---

<div align="center">

**å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸€ä¸ª â­ Starï¼**

Made with â¤ï¸ by the MetaI Team | (c) 2026 Meta Intelligence

</div>
